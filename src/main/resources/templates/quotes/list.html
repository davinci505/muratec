<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/base :: layout(~{::title}, ~{::.content}, ~{}, ~{})}"
      th:with="activePage='quotes'">
<head>
    <title>CCS 견적 관리 - MURATEC</title>
</head>
<body>
    <div class="content">
        <h1 class="mb-4 text-center">CCS 견적 관리</h1>

        <div th:if="${jobRequest != null}" class="alert alert-secondary">
            <strong>의뢰인:</strong> <span th:text="${jobRequest.requester}"></span>
            <span class="ms-3"><strong>작번:</strong> <span th:text="${jobRequest.jobNo}"></span></span>
            <span class="ms-3"><strong>의뢰날짜:</strong> <span th:text="${jobRequest.requestDate}"></span></span>
        </div>

        <div class="mb-3 d-flex gap-2 align-items-center">
            <a th:href="@{/quotes/new(jobId=${jobId})}" class="btn btn-primary">새 견적 추가</a>
            <a href="/quotes/bulk" class="btn btn-success">📊 대량 등록</a>

            <form method="get" action="/quotes" class="ms-auto d-flex gap-2 align-items-center">
                <input type="hidden" name="jobId" th:value="${jobId}">
                <label for="status" class="form-label mb-0">상태</label>
                <select id="status" name="status" class="form-select form-select-sm" style="width: 140px;">
                    <option value="">전체</option>
                    <option th:each="s : ${statusOptions}" th:value="${s}" th:text="${s}" th:selected="${s == status}"></option>
                </select>
                <label for="ccsQuoteNo" class="form-label mb-0">CCS견적번호</label>
                <input id="ccsQuoteNo" name="ccsQuoteNo" type="text" class="form-control form-control-sm"
                       style="width: 160px;" placeholder="번호 검색" th:value="${ccsQuoteNo}">
                <button type="submit" class="btn btn-outline-secondary btn-sm">필터</button>
            </form>
        </div>

        <div th:if="${quotes.isEmpty()}" class="alert alert-info">
            등록된 견적이 없습니다.
        </div>

        <div th:if="${!quotes.isEmpty()}" class="table-responsive">
            <table class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th class="col-medium">의뢰인</th>
                        <th class="col-medium">작번</th>
                        <th class="col-medium">의뢰날짜</th>
                        <th class="col-medium">CCS견적날짜</th>
                        <th class="col-medium">CCS견적번호</th>
                        <th class="col-medium">CCS금액(BRT)</th>
                        <th class="col-medium">CCS금액(HMX)</th>
                        <th class="col-long">내역</th>
                        <th class="col-medium">BRT견적번호</th>
                        <th class="col-medium">BRT견적날짜</th>
                        <th class="col-medium">BRT네고금액</th>
                        <th class="col-medium">상태</th>
                        <th class="col-medium">상태날짜</th>
                        <th class="col-medium">HMX발주번호</th>
                        <th class="col-medium">HMX발주날짜</th>
                        <th class="col-medium">CCSPO번호</th>
                        <th class="col-medium">CCSPO날짜</th>
                        <th class="col-short">관리</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="quote : ${quotes}">
                        <td th:text="${quote.jobRequest != null ? quote.jobRequest.requester : ''}"></td>
                        <td th:text="${quote.jobRequest != null ? quote.jobRequest.jobNo : ''}"></td>
                        <td th:text="${quote.jobRequest != null ? quote.jobRequest.requestDate : ''}"></td>
                        <td th:text="${quote.ccsQuoteDate}"></td>
                        <td>
                            <a th:href="@{/quote-parts(quoteId=${quote.id})}" th:text="${quote.ccsQuoteNo}"></a>
                        </td>
                        <td th:text="${quote.ccsAmountBrt}"></td>
                        <td th:text="${quote.ccsAmountHmx}"></td>
                        <td th:text="${quote.description}"></td>
                        <td th:text="${quote.brtQuoteNo}"></td>
                        <td th:text="${quote.brtQuoteDate}"></td>
                        <td th:text="${quote.brtNegotiatedAmount}"></td>
                        <td th:text="${quote.status}"></td>
                        <td th:text="${quote.statusDate}"></td>
                        <td th:text="${quote.hmxOrderNo}"></td>
                        <td th:text="${quote.hmxOrderDate}"></td>
                        <td th:text="${quote.ccsPoNo}"></td>
                        <td th:text="${quote.ccsPoDate}"></td>
                        <td>
                            <div class="d-flex gap-1 justify-content-center">
                                <a th:href="@{/quotes/edit/{id}(id=${quote.id})}" class="btn btn-sm btn-outline-primary px-2" title="수정" aria-label="수정">
                                    <i class="bi bi-pencil-square"></i>
                                </a>
                                <a th:href="@{/quotes/delete/{id}(id=${quote.id})}" class="btn btn-sm btn-outline-danger px-2" title="삭제" aria-label="삭제" onclick="return confirm('삭제하시겠습니까?');">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
